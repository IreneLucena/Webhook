<html>
<head>
    <title>Listar Candidatos</title>
    <!-- Bootstrap Core CSS -->
    <link href="business/css/bootstrap.min.css" rel="stylesheet">
    <!-- Custom CSS -->
    <link href="business/css/business-casual.css" rel="stylesheet">
    <!-- Fonts -->
    <link href="http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
    <link href="http://fonts.googleapis.com/css?family=Josefin+Slab:100,300,400,600,700,100italic,300italic,400italic,600italic,700italic" rel="stylesheet" type="text/css">
	<script type="text/javascript" src="business/js/jquery-1.12.3.min.js"></script>
    <!-- Bootstrap Core JavaScript -->
    <script src="business/js/bootstrap.min.js"></script>
</head>
<body>

<div class="brand"><span>Lista de Candidatos</span></div>
<!-- Navigation -->
<nav class="navbar navbar-default" role="navigation">
	<div class="container1">
    <!-- Brand and toggle get grouped for better mobile display -->
       <div class="navbar-collapse" id="bs-example-navbar-collapse-1">

<h3>Estado</h3>
<div class="filterStatus">
	<div class="statusDiv"><input type="checkbox" id="nuevos" class="filtroE" name="status" value="Entrante"><label for="nuevos">Nuevos</label></div>
	<div class="statusDiv"><input type="checkbox" id="aceptado" class="filtroE" name="status" value="Aceptado"><label for="aceptado">Aceptados</label></div>
	<div class="statusDiv"><input type="checkbox" id="rechazado" class="filtroE" name="status" value="Rechazado"><label for="rechazado">Rechazados</label></div>
<h3>Categoría</h3>
</div>
<div class="filterCategory">
</div>
</div>
</div>
</nav>
<div class="container">
<div class="row">
<div class="box">
<div class="tablaCat">
<input type="checkbox" id="checkAll" class="darC"><label for="checkAll">Todos</label>
<input type="checkbox" id="uncheckAll" class="darC"><label for="uncheckAll">Ninguno</label>
</div>
<!-- AQUÍ VA LA TABLA -->
<div class="containerOfCandidates"> </div>
</div>
</div>
</div>

<script type="text/javascript">

var count=$('input[name=status]:checked').length;
if (count.length === 0){
	console.log(count);
	$(document).ready(function(){
		$.ajax({
			type: "POST",
			url: "select.php",
			dataType: "html",
			success: function(response){
				$(".maximo").html(response);
			}
		});
	});
}

//Pintar checkbox categoria
	$(document).ready(function() {
		$.ajax({
			type: "GET",
			url: "drawCat.php",
			dataType: "html",
			success: function(response){
				$(".filterCategory").html(response);
			}
		});
	});

//Filtro de estado

$('input[name=status]').change(function(){
	var statusC=[];
	$('input[name=status]:checked').each(function() {
		statusC.push($(this).attr('value'));
	});
	console.log(statusC);
	var statusJoin=statusC.join(",");
	$.ajax({
		type: "post",
		url: "list.php",
		dataType: "text",
		data: {status: statusJoin},
		success: function(response){
			//$(".containerOfCandidates").html(response);
			var data = JSON.parse(response);
			for(var c = 0; c < data.length; c++){
var text= "";
text ='<div class="accordion"><div class="accordion-section-title">' + data[c].name + '<input type="checkbox" id="cat" class="filtroC" name="category" value="' + data[c].name + '"/></div>'+
'<div class="accordion-section-content"><div class="firstContainer"><div class="fecha">Fecha de alta : ' + data[c].dateC + '</div>'+
'<div class="categoria" id="' + data[c].category + '">Categoría : ' + data[c].category + '</div>'+
'<div class="estado" id="' + data[c].status + '">Estado : ' + data[c].status + '</div>'+
'</div><div class="secondContainer"><div class="cuerpoMensaje"><p> Asunto : ' + data[c].subject + '</p><p>Cuerpo : ' + data[c].body + '</p></div></div><div class="thirdContainer">'+
'<input type="button" name="Aceptar" class="boton" id=' + data[c].id + ' value="Aceptar" onclick="aceptar(' + data[c].id + ')"/>'+
'<input type="button" name="Rechazar" class="boton" id=' + data[c].id + ' value="Rechazar" onclick="rechazar(' + data[c].id + ')" />'+
'</div></div></div>';
				$(".containerOfCandidates").append(text);
}
		}
	});
});

//Filtro de categoria
$('input[name=category]').change(function(){
	var categoryC=[];
	$('input[name=category]:checked').each(function() {
		categoryC.push($(this).attr('value'));
	});
	console.log(categoryC);
	var categoryJoin=categoryC.join(",");
	$.ajax({
		type: "post",
		url: "listCast.php",
		dataType: "text",
		data: {category: categoryJoin},
		success: function(response){
			$(".even").html(response);
		}
	});
});

$("#checkAll").click(function(){
	$('input:checkbox').not(this).prop('checked', this.checked);
});

function aceptar(id) {
	$.ajax({
	    url: "update.php",
	    type: "POST",
	    data: {
		    id : id,
		    name : "aceptar"
		    },
	    success: function () {
	        alert("aceptando candidato...");
	        setTimeout(function() 
	       	{
	        	location.reload();
	        }, 1000);
	    }
	});
}
function rechazar(id) {
	$.ajax({
		url: "update.php",
	    type: "POST",
	    data: {
		    id : id,
		    name : "rechazar"
		},
	    success: function () {
	        alert("rechazando candidato...");
	        setTimeout(function() 
	        {
	        	location.reload();
	        }, 1000);
	    }
	});
}
console.log(count);
</script>
    <footer>
    	<p class="footerText">Copyright &copy; DoersDF 2016</p>
    </footer>
</body>
</html>

